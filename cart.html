<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÙØ§ØªÙˆØ±ØªÙƒ - Ø¹Ø¨Ø§Ø¯ Ø§Ù„Ø±Ø­Ù…Ù†</title>
<style>
body { font-family:Tahoma, sans-serif; background:#f5f5f5; color:#222; margin:0; padding:20px; }
.top-bar button {
  background:none;
  border:none;
  color:#630404;
  font-size:25px;
  font-weight:bold;
  cursor:pointer;
}
.top-bar {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:55px;
  background:#d6d6d6;
  color:#630404;
  display:flex;
  z-index:2000;
}
h2 { text-align:center; margin-bottom:20px; }
.cart-addons {
    margin-top: 6px;
    padding-right: 8px;
    font-size: 13px;
}

.addon-line {
    display: flex;
    justify-content: space-between;
    color: #2e7d32;
}

.cart-bottom {
    display: flex;
    justify-content: space-between;
    margin-top: 6px;
    font-weight: bold;
}

.cart-controls {
    display: flex;
    gap: 6px;
    margin-top: 6px;
}

.cart-item { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; background:#fff; padding:10px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,.1); }
.cart-item img { width:80px; height:80px; object-fit:cover; border-radius:8px; margin-left:10px; }
.cart-item div { flex:1; }
button { font-size:14px; font-weight:bold; padding:5px 10px; border:none; border-radius:6px; cursor:pointer; background:#d62828; color:#fff; margin:2px; }
button:hover { background:#ff6f3c; }
#total { font-weight:bold; margin-top:15px; text-align:right; font-size:16px; }
.empty-msg { text-align:center; margin-top:50px; font-size:16px; color:#555; }

/* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ */
.bottom-bar {
  position:fixed;
  flex-direction: column;
  bottom:0;
  left:0;
  align-items:center;
  width:100%;
  background:#fff;
  box-shadow: silver 50px;
  shape-outside: 10px;
  padding:10px;
  display:flex;
  gap:10px;
}

.bottom-bar button {
  background:#0cb344;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:10px 16px;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
  width: 90%;
}

.qty {
  font-size:18px;
  font-weight:bold;
  min-width:30px;
  text-align:center;
  }
#cartContainer {
  padding-bottom: 90px; /* Ù†ÙØ³ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù€ bottom-bar */
}
</style>
<div class="top-bar" style="align-items: center; justify-content: space-between;" >
    <a style="font-size: 14px; padding-right: 10px; color: #0de254cb;    text-decoration: none;" href="" id="clearCartBtn">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</a>
    <h2 style="font-size: 14px; padding-right: 10px;">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
    <button onclick="goBack()"> â† </button>
      </div>

</head>
<body>
<div style="height: 50px;"></div>
<div id="cartContainer"></div>

<div class="bottom-bar">
    <div  id="total"></div>
    <button onclick="sendToWhatsApp()">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ WhatsApp</button>
   <!-- <button onclick="window.location.href='index.html'">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù†ÙŠÙˆ</button>-->

</div>

<script>
let CART = JSON.parse(localStorage.getItem("CART") || "{}");
let CACHE = JSON.parse(localStorage.getItem("OFFLINE_MENU") || "{}"); 

function saveCart(){
    localStorage.setItem("CART", JSON.stringify(CART));
}

function renderCart(){
    const container = document.getElementById("cartContainer");
    container.innerHTML = "";

    if(Object.keys(CART).length === 0){
        container.innerHTML = '<div class="empty-msg">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>';
        document.getElementById("total").textContent = "";
        return;
    }

    let total = 0;

    Object.values(CART).forEach((c, index)=>{

        // ğŸ”¹ Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© + Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª
        const unitFinalPrice =
            Number(c.price) + Number(c.addonsTotal || 0);

        const itemTotal = unitFinalPrice * c.qty;
        total += itemTotal;

        // ğŸ”¹ ØªØ¬Ù‡ÙŠØ² HTML Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª
        let addonsHTML = "";
        if (c.addons && c.addons.length > 0) {
            addonsHTML = `<div class="cart-addons">`;
            c.addons.forEach(a => {
                addonsHTML += `
                    <div class="addon-line">
                        + ${a.name}
                        <span>${Number(a.price).toFixed(2)} Ø¬</span>
                    </div>
                `;
            });
            addonsHTML += `</div>`;
        }

        const div = document.createElement("div");
        div.className = "cart-item";
        div.innerHTML = `
            <img src="${c.img}"
                 style="width:60px;height:60px;object-fit:cover;border-radius:8px;">

            <div class="cart-info">
                <strong>${c.itemName} - ${c.unitName}</strong>

                ${addonsHTML}

                <div class="cart-bottom">
                    <span>Ã— ${c.qty}</span>
                    <span>${itemTotal.toFixed(2)} Ø¬</span>
                </div>
            </div>
        `;

        // ğŸ”¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
        const controls = document.createElement("div");
        controls.className = "cart-controls";

        const btnMinus = document.createElement("button");
        btnMinus.textContent = "-";
        btnMinus.onclick = () => updateQty(c.itemId, c.unitName, -1);

        const btnPlus = document.createElement("button");
        btnPlus.textContent = "+";
        btnPlus.onclick = () => updateQty(c.itemId, c.unitName, 1);

        controls.appendChild(btnMinus);
        controls.appendChild(btnPlus);

        div.querySelector(".cart-info").appendChild(controls);
        container.appendChild(div);
    });

    document.getElementById("total").textContent =
        "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: " + total.toFixed(2) + " Ø¬Ù†ÙŠÙ‡";
}

function updateQty(itemId, unitName, delta){
    const key = `${itemId}-${unitName}`;
    if(!CART[key]) return;
    CART[key].qty += delta;
    if(CART[key].qty <= 0) delete CART[key];
    saveCart();
    renderCart();
}

function removeItem(itemId, unitName){
    const key = `${itemId}-${unitName}`;
    delete CART[key];
    saveCart();
    renderCart();
}

function clearCart(){
    CART = {};
    saveCart();
    renderCart();
}
function sendToWhatsApp(){
    if(Object.keys(CART).length===0){
        alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");
        return;
    }

    let msg = "ğŸ§¾ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯:\n";
    let total = 0;

    Object.values(CART).forEach(c => {
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ†Ù Ù…Ù† CACHE
        const itemData = (() => {
            for (let catId in CACHE.items) {
                const f = CACHE.items[catId].find(i => i.id == c.itemId);
                if (f) return f;
            }
            return null;
        })();

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª
        let addonsTotal = 0;
        let addonsMsg = "";
        if(c.addons && c.addons.length > 0){
            c.addons.forEach(a => {
                addonsTotal += Number(a.price);
                addonsMsg += `  + ${a.name} = ${a.price} Ø¬\n`;
            });
        }

        // Ø­Ø³Ø§Ø¨ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ø·Ø±
        const lineTotal = (Number(c.price) + addonsTotal) * c.qty;
        total += lineTotal;

        // Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØµÙ†Ù
        msg += `\nâ€¢ ${c.itemName} \n - ${c.unitName} Ã— ${c.qty} = ${lineTotal} Ø¬ \n`;
        if(addonsMsg) msg += addonsMsg ;
    });

    msg += `\n ğŸ”» Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬Ù†ÙŠÙ‡`;

    // ÙØªØ­ WhatsApp
    const phone = "+201001741790"; 
    const url = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
    window.open(url, "_blank");
}

// Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
renderCart();
function goBack(){
      
        history.back();
    }
document.getElementById("clearCartBtn").addEventListener("click", function (e) {
  //e.preventDefault(); // ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø±ÙŠÙØ±ÙŠØ´
  CART = {};
  saveCart();
  //updateCartBadge();   // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ù‚Ø·Ø©
  renderCart();        // Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø©
});

</script>

</body>
</html>
